from flask import Flask, jsonify, request
import pandas as pd

app = Flask(__name__)


NFLX_DATA = [
  {"datetime":"2024-12-01","open":88.75100,"high":94.17500,"low":88.41200,"close":89.13200,"volume":572070000},
  {"datetime":"2024-11-01","open":75.34800,"high":90.80000,"low":74.77700,"close":88.68100,"volume":641615000},
  {"datetime":"2024-10-01","open":71.36400,"high":77.30000,"low":67.78800,"close":75.60300,"volume":853369000},
  {"datetime":"2024-09-01","open":70.010002,"high":72.52600,"low":66.080002,"close":70.92700,"volume":531021000},
  {"datetime":"2024-08-01","open":62.92500,"high":71.13300,"low":58.70400,"close":70.13500,"volume":673177000},
  {"datetime":"2024-07-01","open":67.48900,"high":69.74900,"low":61.70000,"close":62.83500,"volume":809087000},
  {"datetime":"2024-06-01","open":64.52200,"high":68.98800,"low":62.64400,"close":67.48800,"volume":542109000},
  {"datetime":"2024-05-01","open":54.78400,"high":66.42500,"low":54.42500,"close":64.16200,"volume":689993000},
  {"datetime":"2024-04-01","open":60.80000,"high":63.90000,"low":54.20100,"close":55.063999,"volume":940103000},
  {"datetime":"2024-03-01","open":59.98100,"high":63.43900,"low":59.20000,"close":60.73300,"volume":601511000},
  {"datetime":"2024-02-01","open":56.70200,"high":60.53600,"low":54.90000,"close":60.29200,"volume":716465000},
  {"datetime":"2024-01-01","open":48.31900,"high":57.96400,"low":46.18600,"close":56.41100,"volume":1459217000},
  {"datetime":"2023-12-01","open":47.31700,"high":50.089001,"low":44.57300,"close":48.68800,"volume":804230000},
  {"datetime":"2023-11-01","open":41.47700,"high":48.27000,"low":41.41800,"close":47.39700,"volume":717437000},
  {"datetime":"2023-10-01","open":37.74800,"high":41.88400,"low":34.47300,"close":41.16900,"volume":1640406000},
  {"datetime":"2023-09-01","open":43.77300,"high":45.34500,"low":37.11000,"close":37.76000,"volume":1002925000},
  {"datetime":"2023-08-01","open":43.73700,"high":44.52500,"low":39.81500,"close":43.36800,"volume":1073031000},
  {"datetime":"2023-07-01","open":43.97600,"high":48.5,"low":41.18800,"close":43.89700,"volume":1686120000},
  {"datetime":"2023-06-01","open":39.74100,"high":44.86500,"low":39.30800,"close":44.049000,"volume":1472532000},
  {"datetime":"2023-05-01","open":32.94400,"high":40.51100,"low":31.56200,"close":39.52300,"volume":1454850000},
  {"datetime":"2023-04-01","open":34.18300,"high":34.98000,"low":31.61000,"close":32.99300,"volume":1279910000},
  {"datetime":"2023-03-01","open":32.15500,"high":34.58400,"low":28.53300,"close":34.54800,"volume":1575554000},
  {"datetime":"2023-02-01","open":35.38600,"high":37.94300,"low":31.43000,"close":32.21300,"volume":1233741000},
  {"datetime":"2023-01-01","open":29.80600,"high":36.90200,"low":28.87000,"close":35.38600,"volume":2064174000},
  {"datetime":"2022-12-01","open":30.39900,"high":33.27200,"low":27.34100,"close":29.48800,"volume":1930809000},
  {"datetime":"2022-11-01","open":29.61700,"high":31.27100,"low":25.20900,"close":30.55300,"volume":1856830000},
  {"datetime":"2022-10-01","open":23.78500,"high":30.56300,"low":21.17300,"close":29.18800,"volume":3352638000},
  {"datetime":"2022-09-01","open":22.072001,"high":25.049000,"low":21.46900,"close":23.54400,"volume":2339207000},
  {"datetime":"2022-08-01","open":22.31000,"high":25.19900,"low":21.87400,"close":22.35600,"volume":1522583000},
  {"datetime":"2022-07-01","open":17.64900,"high":23.075001,"low":16.97000,"close":22.49000,"volume":2700837000},
  {"datetime":"2022-06-01","open":19.87000,"high":20.73800,"low":16.42800,"close":17.48700,"volume":1925527000},
  {"datetime":"2022-05-01","open":19.17100,"high":20.43800,"low":16.27100,"close":19.74400,"volume":2516158000},
  {"datetime":"2022-04-01","open":37.68000,"high":39.60200,"low":18.56000,"close":19.035999,"volume":4033254000},
  {"datetime":"2022-03-01","open":39.16000,"high":39.65000,"low":32.98200,"close":37.45900,"volume":1194919000},
  {"datetime":"2022-02-01","open":43.29600,"high":45.84800,"low":35.47200,"close":39.45200,"volume":1510107000},
  {"datetime":"2022-01-01","open":60.56100,"high":60.99900,"low":35.14600,"close":42.71400,"volume":2416620000},
  {"datetime":"2021-12-01","open":64.94800,"high":65.45200,"low":58.17400,"close":60.24400,"volume":599753000},
  {"datetime":"2021-11-01","open":68.90600,"high":70.098999,"low":64.00099945,"close":64.19000,"volume":645302000},
  {"datetime":"2021-10-01","open":60.42400,"high":69.097000,"low":59.46800,"close":69.030998,"volume":985763000},
  {"datetime":"2021-09-01","open":56.90000,"high":61.90000,"low":56.80800,"close":61.034000,"volume":823175000},
  {"datetime":"2021-08-01","open":51.90000,"high":56.94800,"low":50.53700,"close":56.91900,"volume":547477000},
  {"datetime":"2021-07-01","open":52.57200,"high":55.75400,"low":50.46600,"close":51.75700,"volume":772212000},
  {"datetime":"2021-06-01","open":50.40100,"high":53.61300,"low":48.21400,"close":52.82100,"volume":785606000},
  {"datetime":"2021-05-01","open":51.26500,"high":51.89500,"low":47.85400,"close":50.28100,"volume":669276000},
  {"datetime":"2021-04-01","open":52.99300,"high":56.35600,"low":49.90000,"close":51.34700,"volume":1115733000},
  {"datetime":"2021-03-01","open":54.55700,"high":55.69900,"low":49.28500,"close":52.16600,"volume":901839000},
  {"datetime":"2021-02-01","open":53.67900,"high":56.66500,"low":51.82800,"close":53.88500,"volume":619023000},
  {"datetime":"2021-01-01","open":53.90000,"high":59.32900,"low":48.56700,"close":53.23900,"volume":1399886000},
  {"datetime":"2020-12-01","open":49.23400,"high":54.55000,"low":49.12900,"close":54.073002,"volume":775641000},
  {"datetime":"2020-11-01","open":47.88700,"high":51.87300,"low":46.34100,"close":49.070000,"volume":917889000},
  {"datetime":"2020-10-01","open":50.60300,"high":57.24900,"low":47.22100,"close":47.57400,"volume":1543024000},
  {"datetime":"2020-09-01","open":53.26000,"high":55.73900,"low":45.86000,"close":50.0029984,"volume":1187969000},
  {"datetime":"2020-08-01","open":49.085999,"high":54.90400,"low":46.65500,"close":52.95600,"volume":1162619000},
  {"datetime":"2020-07-01","open":45.40000,"high":57.53700,"low":45.40000,"close":48.88800,"volume":2322063000},
  {"datetime":"2020-06-01","open":41.88300,"high":47.40100,"low":40.42500,"close":45.50400,"volume":1172799000},
  {"datetime":"2020-05-01","open":41.51000,"high":45.89700,"low":39.78600,"close":41.97300,"volume":1350558000},
  {"datetime":"2020-04-01","open":37.60500,"high":44.95200,"low":35.75100,"close":41.98500,"volume":2251116000},
  {"datetime":"2020-03-01","open":37.31100,"high":39.35200,"low":29.025000,"close":37.55000,"volume":2019791000},
  {"datetime":"2020-02-01","open":34.72400,"high":39.29500,"low":34.62800,"close":36.90300,"volume":1140560000},
  {"datetime":"2020-01-01","open":32.61000,"high":35.98500,"low":32.12000,"close":34.50900,"volume":1698740000},
  {"datetime":"2019-12-01","open":31.43900,"high":33.80000,"low":29.20200,"close":32.35700,"volume":1247236000}
]


MSFT_DATA = [
  {"datetime":"2024-12-01","open":421.57001,"high":456.16000,"low":420.66000,"close":421.5,"volume":439902400},
{"datetime":"2024-11-01","open":409.010010,"high":429.32999,"low":405.57001,"close":423.45999,"volume":442321200},
{"datetime":"2024-10-01","open":428.45001,"high":438.5,"low":406.29999,"close":406.35001,"volume":440745500},
{"datetime":"2024-09-01","open":417.91000,"high":441.85001,"low":400.79999,"close":430.29999,"volume":376921200},
{"datetime":"2024-08-01","open":420.79001,"high":427.45999,"low":385.57999,"close":417.14001,"volume":451919000},
{"datetime":"2024-07-01","open":448.66000,"high":468.35001,"low":412.20999,"close":418.35001,"volume":440449200},
{"datetime":"2024-06-01","open":415.53000,"high":456.17001,"low":408.92001,"close":446.95001,"volume":342370400},
{"datetime":"2024-05-01","open":392.60999,"high":433.60001,"low":390.31000,"close":415.13000,"volume":413800800},
{"datetime":"2024-04-01","open":423.95001,"high":429.37000,"low":388.029999,"close":389.32999,"volume":440777700},
{"datetime":"2024-03-01","open":411.26999,"high":430.82001,"low":398.39001,"close":420.72000,"volume":426349600},
{"datetime":"2024-02-01","open":401.82999,"high":420.82001,"low":397.22000,"close":413.64001,"volume":444176300},
{"datetime":"2024-01-01","open":373.85999,"high":415.32001,"low":366.5,"close":397.57999,"volume":528399000},
{"datetime":"2023-12-01","open":376.76001,"high":378.16000,"low":362.89999,"close":376.040009,"volume":522003700},
{"datetime":"2023-11-01","open":339.79001,"high":384.29999,"low":339.64999,"close":378.91000,"volume":563880300},
{"datetime":"2023-10-01","open":316.28000,"high":346.20001,"low":311.20999,"close":338.10999,"volume":540907000},
{"datetime":"2023-09-01","open":331.31000,"high":340.85999,"low":309.45001,"close":315.75,"volume":416680700},
{"datetime":"2023-08-01","open":335.19000,"high":338.54001,"low":311.54999,"close":327.76001,"volume":479456700},
{"datetime":"2023-07-01","open":339.19000,"high":366.78000,"low":327,"close":335.92001,"volume":666764400},
{"datetime":"2023-06-01","open":325.92999,"high":351.47000,"low":322.5,"close":340.54001,"volume":547588700},
{"datetime":"2023-05-01","open":306.97000,"high":335.94000,"low":303.39999,"close":328.39001,"volume":600807200},
{"datetime":"2023-04-01","open":286.51999,"high":308.92999,"low":275.37000,"close":307.26001,"volume":551497100},
{"datetime":"2023-03-01","open":250.75999,"high":289.26999,"low":245.61000,"close":288.29999,"volume":747635000},
{"datetime":"2023-02-01","open":248,"high":276.76001,"low":245.47000,"close":249.42000,"volume":615501000},
{"datetime":"2023-01-01","open":243.080002,"high":249.83000,"low":219.35001,"close":247.81000,"volume":666168100},
{"datetime":"2022-12-01","open":253.87000,"high":263.92001,"low":233.87000,"close":239.82001,"volume":591358700},
{"datetime":"2022-11-01","open":234.60001,"high":255.33000,"low":213.42999,"close":255.14000,"volume":615296000},
{"datetime":"2022-10-01","open":235.41000,"high":251.039993,"low":219.13000,"close":232.13000,"volume":671225100},
{"datetime":"2022-09-01","open":258.87000,"high":267.45001,"low":232.73000,"close":232.89999,"volume":575586600},
{"datetime":"2022-08-01","open":277.82001,"high":294.17999,"low":260.66000,"close":261.47000,"volume":477157600},
{"datetime":"2022-07-01","open":256.39001,"high":282,"low":245.94000,"close":280.73999,"volume":534891800},
{"datetime":"2022-06-01","open":275.20001,"high":277.69000,"low":241.50999,"close":256.82999,"volume":621372300},
{"datetime":"2022-05-01","open":277.70999,"high":290.88000,"low":246.44000,"close":271.87000,"volume":742902000},
{"datetime":"2022-04-01","open":309.37000,"high":315.10999,"low":270,"close":277.51999,"volume":627343400},
{"datetime":"2022-03-01","open":296.39999,"high":315.95001,"low":270,"close":308.31000,"volume":734334200},
{"datetime":"2022-02-01","open":310.41000,"high":315.12000,"low":271.51999,"close":298.79001,"volume":697050600},
{"datetime":"2022-01-01","open":335.35001,"high":338,"low":276.049988,"close":310.98001,"volume":947531400},
{"datetime":"2021-12-01","open":335.13000,"high":344.29999,"low":317.25,"close":336.32001,"volume":625674800},
{"datetime":"2021-11-01","open":331.35999,"high":349.67001,"low":326.37000,"close":330.59000,"volume":509885200},
{"datetime":"2021-10-01","open":282.12000,"high":332,"low":280.25,"close":331.62000,"volume":516515800},
{"datetime":"2021-09-01","open":302.87000,"high":305.32001,"low":281.62000,"close":281.92001,"volume":502918700},
{"datetime":"2021-08-01","open":286.35999,"high":305.84000,"low":283.73999,"close":301.88000,"volume":441308900},
{"datetime":"2021-07-01","open":269.60999,"high":290.14999,"low":269.60001,"close":284.91000,"volume":522672700},
{"datetime":"2021-06-01","open":251.23000,"high":271.64999,"low":243,"close":270.89999,"volume":508572200},
{"datetime":"2021-05-01","open":253.39999,"high":254.35001,"low":238.070007,"close":249.67999,"volume":495084900},
{"datetime":"2021-04-01","open":238.47000,"high":263.19000,"low":238.050003,"close":252.17999,"volume":568661600},
{"datetime":"2021-03-01","open":235.89999,"high":241.050003,"low":224.25999,"close":235.77000,"volume":724945800},
{"datetime":"2021-02-01","open":235.059998,"high":246.13000,"low":227.88000,"close":232.38000,"volume":490962200},
{"datetime":"2021-01-01","open":222.53000,"high":242.64000,"low":211.94000,"close":231.96001,"volume":648076400},
{"datetime":"2020-12-01","open":214.50999,"high":227.17999,"low":209.11000,"close":222.42000,"volume":594761700},
{"datetime":"2020-11-01","open":204.28999,"high":228.12000,"low":200.12000,"close":214.070007,"volume":573443000},
{"datetime":"2020-10-01","open":213.49001,"high":225.21001,"low":199.62000,"close":202.47000,"volume":631618000},
{"datetime":"2020-09-01","open":225.50999,"high":232.86000,"low":196.25,"close":210.33000,"volume":768176300},
{"datetime":"2020-08-01","open":211.52000,"high":231.14999,"low":203.14000,"close":225.53000,"volume":692423900},
{"datetime":"2020-07-01","open":203.14000,"high":216.38000,"low":197.50999,"close":205.0099945,"volume":770190800},
{"datetime":"2020-06-01","open":182.53999,"high":204.39999,"low":181.35001,"close":203.50999,"volume":764965400},
{"datetime":"2020-05-01","open":175.80000,"high":187.50999,"low":173.80000,"close":183.25,"volume":688845000},
{"datetime":"2020-04-01","open":153,"high":180.39999,"low":150.36000,"close":179.21001,"volume":984705000},
{"datetime":"2020-03-01","open":165.31000,"high":175,"low":132.52000,"close":157.71001,"volume":1612695500},
{"datetime":"2020-02-01","open":170.42999,"high":190.70000,"low":152,"close":162.0099945,"volume":887522300},
{"datetime":"2020-01-01","open":158.78000,"high":174.050003,"low":156.50999,"close":170.23000,"volume":558530000},
{"datetime":"2019-12-01","open":151.81000,"high":159.55000,"low":146.64999,"close":157.70000,"volume":450303300}
]

SPY_DATA = [
  {"datetime":"2024-12-01","open":602.96997,"high":609.070007,"low":580.90997,"close":586.080017,"volume":1059516700},
  {"datetime":"2024-11-01","open":571.32001,"high":603.34998,"low":567.89001,"close":602.54999,"volume":901843000},
  {"datetime":"2024-10-01","open":573.40002,"high":586.12000,"low":565.27002,"close":568.64001,"volume":976068800},
  {"datetime":"2024-09-01","open":560.46997,"high":574.71002,"low":539.44000,"close":573.76001,"volume":1045061400},
  {"datetime":"2024-08-01","open":552.57001,"high":564.20001,"low":510.26999,"close":563.67999,"volume":1244599000},
  {"datetime":"2024-07-01","open":545.63000,"high":565.15997,"low":537.45001,"close":550.81000,"volume":1038465500},
  {"datetime":"2024-06-01","open":529.020020,"high":550.28003,"low":522.59998,"close":544.21997,"volume":888923200},
  {"datetime":"2024-05-01","open":501.38000,"high":533.070007,"low":499.54999,"close":527.37000,"volume":1153264400},
  {"datetime":"2024-04-01","open":523.83002,"high":524.38000,"low":493.85999,"close":501.98001,"volume":1592974000},
  {"datetime":"2024-03-01","open":508.98001,"high":524.60999,"low":504.91000,"close":523.070007,"volume":1473246900},
  {"datetime":"2024-02-01","open":484.63000,"high":510.13000,"low":483.79999,"close":508.079987,"volume":1393465400},
  {"datetime":"2024-01-01","open":472.16000,"high":491.62000,"low":466.42999,"close":482.88000,"volume":1700630800},
  {"datetime":"2023-12-01","open":455.76999,"high":477.54999,"low":454.31000,"close":475.31000,"volume":1643108100},
  {"datetime":"2023-11-01","open":419.20001,"high":458.32001,"low":418.64999,"close":456.39999,"volume":1499960600},
  {"datetime":"2023-10-01","open":426.62000,"high":438.14001,"low":409.20999,"close":418.20001,"volume":1999149700},
  {"datetime":"2023-09-01","open":453.17001,"high":453.67001,"low":422.29001,"close":427.48001,"volume":1588673200},
  {"datetime":"2023-08-01","open":456.26999,"high":457.25,"low":433.010010,"close":450.35001,"volume":1754764700},
  {"datetime":"2023-07-01","open":442.92001,"high":459.44000,"low":437.059998,"close":457.79001,"volume":1374632400},
  {"datetime":"2023-06-01","open":418.089996,"high":444.29999,"low":416.79001,"close":443.28000,"volume":1749755000},
  {"datetime":"2023-05-01","open":415.47000,"high":422.57999,"low":403.73999,"close":417.85001,"volume":1780705600},
  {"datetime":"2023-04-01","open":408.85001,"high":415.94000,"low":403.78000,"close":415.92999,"volume":1395683000},
  {"datetime":"2023-03-01","open":395.41000,"high":409.70001,"low":380.64999,"close":409.39001,"volume":2515995800},
  {"datetime":"2023-02-01","open":405.20999,"high":418.31000,"low":393.64001,"close":396.26001,"volume":1603094700},
  {"datetime":"2023-01-01","open":384.37000,"high":408.16000,"low":377.82999,"close":406.48001,"volume":1575450100},
  {"datetime":"2022-12-01","open":408.76999,"high":410.48999,"low":374.76999,"close":382.42999,"volume":1735973600},
  {"datetime":"2022-11-01","open":390.14001,"high":407.67999,"low":368.79001,"close":407.67999,"volume":1745985300},
  {"datetime":"2022-10-01","open":361.079987,"high":389.51999,"low":348.10999,"close":386.20999,"volume":2024732000},
  {"datetime":"2022-09-01","open":392.89001,"high":411.73001,"low":357.040009,"close":357.17999,"volume":1998908600},
  {"datetime":"2022-08-01","open":409.14999,"high":431.73001,"low":395.040009,"close":395.17999,"volume":1443394400},
  {"datetime":"2022-07-01","open":376.56000,"high":413.029999,"low":371.040009,"close":411.98999,"volume":1437748400},
  {"datetime":"2022-06-01","open":415.17001,"high":417.44000,"low":362.17001,"close":377.25,"volume":1958611900},
  {"datetime":"2022-05-01","open":412.070007,"high":429.66000,"low":380.54001,"close":412.92999,"volume":2418478100},
  {"datetime":"2022-04-01","open":453.31000,"high":457.82999,"low":411.20999,"close":412,"volume":1856757400},
  {"datetime":"2022-03-01","open":435.040009,"high":462.070007,"low":415.12000,"close":451.64001,"volume":2380929500},
  {"datetime":"2022-02-01","open":450.67999,"high":458.12000,"low":410.64001,"close":436.63000,"volume":2297975100},
  {"datetime":"2022-01-01","open":476.29999,"high":479.98001,"low":420.76001,"close":449.91000,"volume":2485167800},
  {"datetime":"2021-12-01","open":461.64001,"high":479,"low":448.92001,"close":474.95999,"volume":1927433900},
  {"datetime":"2021-11-01","open":460.29999,"high":473.54001,"low":455.29999,"close":455.56000,"volume":1335351500},
  {"datetime":"2021-10-01","open":430.98001,"high":459.56000,"low":426.35999,"close":459.25,"volume":1508665200},
  {"datetime":"2021-09-01","open":452.56000,"high":454.049988,"low":428.78000,"close":429.14001,"volume":1745559600},
  {"datetime":"2021-08-01","open":440.34000,"high":453.070007,"low":436.10001,"close":451.56000,"volume":1254001400},
  {"datetime":"2021-07-01","open":428.87000,"high":441.79999,"low":421.97000,"close":438.51001,"volume":1422104700},
  {"datetime":"2021-06-01","open":422.57001,"high":428.78000,"low":414.70001,"close":428.059998,"volume":1282152400},
  {"datetime":"2021-05-01","open":419.42999,"high":422.82001,"low":404,"close":420.040009,"volume":1547235900},
  {"datetime":"2021-04-01","open":398.39999,"high":420.72000,"low":398.17999,"close":417.29999,"volume":1462106600},
  {"datetime":"2021-03-01","open":385.59000,"high":398.12000,"low":371.88000,"close":396.32999,"volume":2401715800},
  {"datetime":"2021-02-01","open":373.72000,"high":394.17001,"low":370.38000,"close":380.35999,"volume":1307806200},
  {"datetime":"2021-01-01","open":375.31000,"high":385.85001,"low":364.82001,"close":370.070007,"volume":1402265400},
  {"datetime":"2020-12-01","open":365.57001,"high":378.45999,"low":362.029999,"close":373.88000,"volume":1344541500},
  {"datetime":"2020-11-01","open":330.20001,"high":364.38000,"low":327.23999,"close":362.059998,"volume":1535244300},
  {"datetime":"2020-10-01","open":337.69000,"high":354.019989,"low":322.60001,"close":326.54001,"volume":1629016100},
  {"datetime":"2020-09-01","open":350.20999,"high":358.75,"low":319.79999,"close":334.89001,"volume":1814712700},
  {"datetime":"2020-08-01","open":328.32001,"high":351.29999,"low":327.73001,"close":349.31000,"volume":1045563300},
  {"datetime":"2020-07-01","open":309.57001,"high":327.23001,"low":309.070007,"close":326.51999,"volume":1505145300},
  {"datetime":"2020-06-01","open":303.62000,"high":323.41000,"low":296.73999,"close":308.35999,"volume":2358674500},
  {"datetime":"2020-05-01","open":285.31000,"high":306.84000,"low":272.98999,"close":304.32001,"volume":1910460500},
  {"datetime":"2020-04-01","open":247.98000,"high":294.88000,"low":243.89999,"close":290.48001,"volume":2819312300},
  {"datetime":"2020-03-01","open":298.20999,"high":313.84000,"low":218.25999,"close":257.75,"volume":5926017600},
  {"datetime":"2020-02-01","open":323.35001,"high":339.079987,"low":285.54001,"close":296.26001,"volume":2110214900},
  {"datetime":"2020-01-01","open":323.54001,"high":332.95001,"low":320.35999,"close":321.73001,"volume":1392003800},
  {"datetime":"2019-12-01","open":314.59000,"high":323.79999,"low":307.13000,"close":321.85999,"volume":1285175800}
]




DATASETS = {
    "MSFT": MSFT_DATA,
    "NFLX": NFLX_DATA,
    "SPY": SPY_DATA,
}


def compute_drawdown_series(data_list):
    data = pd.DataFrame(data_list)

    data["datetime"] = pd.to_datetime(data["datetime"])
    data = data.sort_values("datetime")

    data["monthly_return"] = data["close"].pct_change()
    data["rebased"] = (1 + data["monthly_return"].fillna(0)).cumprod() * 100
    data["peak"] = data["rebased"].cummax()
    data["drawdown"] = (data["rebased"] / data["peak"] - 1) * 100

    mdd = data["drawdown"].min()
    mdd_abs = abs(mdd)

    series = data[["datetime", "drawdown"]].copy()
    series["datetime"] = series["datetime"].dt.strftime("%Y-%m-%d")

    return float(mdd_abs), series.to_dict(orient="records")


@app.route("/stocks", methods=["GET"])
def get_stocks():
    symbol = request.args.get("symbol", "MSFT").upper()

    if symbol not in DATASETS:
        return jsonify({"error": f"Unknown symbol '{symbol}'"}), 400

    mdd_value, series = compute_drawdown_series(DATASETS[symbol])

    return jsonify({
        "symbol": symbol,
        "mdd": round(mdd_value, 6),
        "series": series 
    })


if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5001, debug=True)



